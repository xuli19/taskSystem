<?php
    header("content-type:text/html;charset=utf-8");
    include_once('./ConnectDB.php');
    include_once('../jxyx/public/phpqrcode/qrlib.php');
    include_once('./public/download.php');

    $codeId = (int)$_GET["id"];
    $query ="select * from classroominfo where id = ".$codeId ." limit 1";

    if ($con = connectDB()) {
        $result = queryTable($con, $query);
    }
    foreach ($result as $key => $value) {
        $classroom = $value['building'].$value['district'].$value['roomNO'];
        $seats = $value['seats'];
        $tel = $value['IPNO'];
        $buildTime = $value['updateTime'];
    }
$code=<<<CODE
æ•™å®¤ï¼š{$classroom}
åº§ä½æ•°ï¼š{$seats}
è”ç³»ç”µè¯ï¼š{$tel}
å»ºæˆæ—¶é—´ï¼š{$buildTime}
CODE;

    QRcode::png($code,'class.png');
    $qpng = "class.png";

    $temp_path = './qr/';
    $fileName = $codeId.'.png';

    $pngAbsoluteFilePath = $temp_path.$fileName;
    $urlRelativeFilePath = './qr/'.$fileName; 


    if (!file_exists($pngAbsoluteFilePath)) {
        QRcode::png($code, $pngAbsoluteFilePath);
        echo '<script> alert("ğŸ˜‹ç”ŸæˆæˆåŠŸï¼"); javascript:history.back()</script>';


    } else {
        echo 'å‡ºç°é”™è¯¯äº†ï¼';
        echo '<hr />';
    }
    
    // echo 'Server PNG File: '.$pngAbsoluteFilePath; //æ˜¾ç¤ºç”Ÿæˆæ–‡ä»¶ä¿å­˜çš„ä½ç½®
    // echo '<hr />';
    
    // displaying
    echo '<img src="'.$urlRelativeFilePath.'" />'; 
?>